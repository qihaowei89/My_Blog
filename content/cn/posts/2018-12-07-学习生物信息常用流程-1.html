---
title: 学习生物信息常用流程-1
author: ''
date: '2018-12-07'
slug: 学习生物信息常用流程-1
categories:
  - Bioinfomatics
tags:
  - RNA-seq 
  - pipeline     
  - bioinfomatics
css: []
description: ''
highlight: yes
index: no
scripts: []
---



<div id="rnacocktail一种精确高效的rna-seq分析框架" class="section level3">
<h3>RNACocktail:一种精确高效的RNA-seq分析框架</h3>
<p>From：<a href="https://bioinform.github.io/rnacocktail/" class="uri">https://bioinform.github.io/rnacocktail/</a></p>
<p>RNACocktail pipeline可对短read和长read进行广谱的RNA-Seq分析，以便能够从转录数据获得有意义的见解。它是在分析了各种RNA-Seq样品(从生殖系、癌症到干细胞数据集)以及使用多种工具组合来确定一个全面、快速和准确的pipeline的技术之后开发的。</p>
<table>
<thead>
<tr class="header">
<th>short-read</th>
<th>long-read</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>alignment</td>
<td>error correction</td>
</tr>
<tr class="even">
<td>transcriptome reconstruction</td>
<td>alignment</td>
</tr>
<tr class="odd">
<td>denovo transcriptome assembly</td>
<td>transcriptome reconstruction</td>
</tr>
<tr class="even">
<td>alignment-free quantification</td>
<td>fusion prediction</td>
</tr>
<tr class="odd">
<td>differential expression analysis</td>
<td></td>
</tr>
<tr class="even">
<td>fusion prediction</td>
<td></td>
</tr>
<tr class="odd">
<td>variant calling</td>
<td></td>
</tr>
<tr class="even">
<td>RNA editing prediction</td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div id="下载rnacocktail" class="section level3">
<h3>1 下载RNACocktail</h3>
<p><a href="https://github.com/bioinform/RNACocktail/archive/v0.2.2.tar.gz">最新版本下载地址</a><br />
<a href="https://github.com/bioinform/RNACocktail/releases">历史版本下载地址</a></p>
</div>
<div id="rnacocktail-docker镜像" class="section level3">
<h3>2 RNACocktail Docker镜像</h3>
<p>rnacocktail Docker镜像<a href="https://hub.docker.com/r/marghoob/rnacocktail/">下载地址</a><br />
Docker镜像制作的Dockerfile<a href="https://github.com/bioinform/rnacocktail/blob/master/docker/Dockerfile">下载地址</a></p>
</div>
<div id="系统要求" class="section level3">
<h3>3 系统要求</h3>
<p>安装Python 2.7 以及下面的py包：</p>
<table>
<thead>
<tr class="header">
<th align="center">Tool</th>
<th align="center">Version tested</th>
<th align="center">Pipeline modes used in</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">pybedtools</td>
<td align="center">0.7.7</td>
<td align="center">editing</td>
</tr>
<tr class="even">
<td align="center">pysam</td>
<td align="center">0.9.0</td>
<td align="center">editing</td>
</tr>
<tr class="odd">
<td align="center">numpy</td>
<td align="center">1.12.0</td>
<td align="center">editing</td>
</tr>
<tr class="even">
<td align="center">scipy</td>
<td align="center">0.18.1</td>
<td align="center">long_fusion</td>
</tr>
<tr class="odd">
<td align="center">biopython</td>
<td align="center">1.66</td>
<td align="center">fusion</td>
</tr>
<tr class="even">
<td align="center">openpyxl</td>
<td align="center">1.5.6</td>
<td align="center">fusion</td>
</tr>
<tr class="odd">
<td align="center">pandas</td>
<td align="center">0.19.2</td>
<td align="center">fusion</td>
</tr>
<tr class="even">
<td align="center">xlrd</td>
<td align="center">0.6.1</td>
<td align="center">fusion</td>
</tr>
</tbody>
</table>
<p>pybedtools依赖<a href="https://github.com/arq5x/bedtools2">bedtools</a>(v2.27.0) 软件。</p>
<p>此外，必须提供以下工具的路径作为RNACocktail参数。或者，工具的可执行文件可以是环境变量中路径，也可以定义在<code>defaults.py</code>：</p>
<table>
<thead>
<tr class="header">
<th>Tool</th>
<th>Version</th>
<th>Pipeline modes used in</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://github.com/samtools/samtools">SAMtools</a></td>
<td>1.2</td>
<td>align, reconstruct, long_align, long_reconstruct, and editing</td>
</tr>
<tr class="even">
<td><a href="http://ccb.jhu.edu/software/hisat2/index.shtml">HISAT2</a></td>
<td>2.0.5</td>
<td>align</td>
</tr>
<tr class="odd">
<td><a href="https://ccb.jhu.edu/software/stringtie/index.shtml">StringTie</a></td>
<td>1.3.3</td>
<td>reconstruct and diff</td>
</tr>
<tr class="even">
<td><a href="https://github.com/COMBINE-lab/salmon">Salmon</a></td>
<td>0.8.0</td>
<td>quantify</td>
</tr>
<tr class="odd">
<td><a href="https://github.com/dzerbino/oases">Oases</a></td>
<td>0.2.09</td>
<td>assembly</td>
</tr>
<tr class="even">
<td><a href="https://github.com/dzerbino/velvet">Velvet</a></td>
<td>1.2.10</td>
<td>assembly</td>
</tr>
<tr class="odd">
<td>R with <a href="https://www.bioconductor.org/packages/devel/bioc/html/DESeq2.html">DESeq2</a>, <a href="https://github.com/hadley/readr">readr</a>, and <a href="https://github.com/mikelove/tximport">tximport</a>,rjson, libraries</td>
<td>3.3.2</td>
<td>diff, editing</td>
</tr>
<tr class="even">
<td><a href="http://bioinf.wehi.edu.au/featureCounts/">featureCounts</a></td>
<td>1.5.0-p1</td>
<td>diff</td>
</tr>
<tr class="odd">
<td><a href="http://www.atgc-montpellier.fr/lordec/">LoRDEC</a></td>
<td>0.6</td>
<td>long_correct</td>
</tr>
<tr class="even">
<td><a href="https://github.com/alexdobin/STAR">STAR</a></td>
<td>2.5.2b</td>
<td>long_align</td>
</tr>
<tr class="odd">
<td><a href="https://www.healthcare.uiowa.edu/labs/au/IDP/">IDP</a></td>
<td>0.1.9</td>
<td>long_reconstruct</td>
</tr>
<tr class="even">
<td><a href="https://www.healthcare.uiowa.edu/labs/au/IDP-fusion/">IDP-fusion</a></td>
<td>1.1.1</td>
<td>long_fusion</td>
</tr>
<tr class="odd">
<td><a href="https://software.broadinstitute.org/gatk/">GATK</a></td>
<td>3.5-0</td>
<td>variant and editing</td>
</tr>
<tr class="even">
<td><a href="https://broadinstitute.github.io/picard/">Picard</a></td>
<td>2.2.2</td>
<td>variant</td>
</tr>
<tr class="odd">
<td><a href="https://github.com/zhqingit/giremi">GIREMI</a></td>
<td>0.2.1</td>
<td>editing</td>
</tr>
<tr class="even">
<td><a href="https://github.com/GATB/gatb-core">gatb-core</a></td>
<td>1.1.0</td>
<td>editing</td>
</tr>
<tr class="odd">
<td><a href="https://github.com/samtools/htslib">HTSlib</a></td>
<td>1.3</td>
<td>editing</td>
</tr>
<tr class="even">
<td><a href="https://github.com/ndaniel/fusioncatcher">FusionCatcher</a><a href="https://sourceforge.net/projects/fusioncatcher/files/data/">fusioncatcher download</a></td>
<td>0.99.5a beta</td>
<td>fusion</td>
</tr>
<tr class="odd">
<td><a href="http://bowtie-bio.sourceforge.net/index.shtml">bowtie</a></td>
<td>1.2.0</td>
<td>fusion</td>
</tr>
<tr class="even">
<td><a href="http://bowtie-bio.sourceforge.net/bowtie2/index.shtml">bowtie2</a></td>
<td>2.2.9</td>
<td>fusion, long_fusion</td>
</tr>
<tr class="odd">
<td><a href="http://bio-bwa.sourceforge.net/">bwa</a></td>
<td>0.7.15</td>
<td>fusion</td>
</tr>
<tr class="even">
<td><a href="https://github.com/ncbi/sra-tools">sra toolkit</a></td>
<td>2.8.1</td>
<td>fusion</td>
</tr>
<tr class="odd">
<td><a href="http://ftp.gnu.org/gnu/coreutils/">coreutils</a></td>
<td>8.25</td>
<td>fusion</td>
</tr>
<tr class="even">
<td><a href="http://zlib.net/pigz/">pigz</a></td>
<td>2.3.1</td>
<td>fusion</td>
</tr>
<tr class="odd">
<td><a href="http://hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64/blat">blat</a></td>
<td>0.35</td>
<td>fusion</td>
</tr>
<tr class="even">
<td><a href="http://hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64/faToTwoBit">faToTwoBit</a></td>
<td></td>
<td>fusion</td>
</tr>
<tr class="odd">
<td><a href="http://hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64.v287/liftOver">liftOver</a></td>
<td></td>
<td>fusion</td>
</tr>
<tr class="even">
<td><a href="https://github.com/ndaniel/seqtk">SeqTK</a></td>
<td>1.0-r82b</td>
<td>fusion</td>
</tr>
<tr class="odd">
<td><a href="http://research-pub.gene.com/gmap/">gmap</a></td>
<td>2017-02-15</td>
<td>long_fusion</td>
</tr>
</tbody>
</table>
</div>
<div id="安装rnacocktail" class="section level3">
<h3>4 安装RNACocktail</h3>
<p>RNACocktail是python的一个软件包，可以使用pip安装(<a href="https://github.com/bioinform/RNACocktail/archive/v0.2.2.tar.gz" class="uri">https://github.com/bioinform/RNACocktail/archive/v0.2.2.tar.gz</a>),通常，安装源将是:<a href="https://github.com/bioinform/RNACocktail/archive/version.tar.gz" class="uri">https://github.com/bioinform/RNACocktail/archive/version.tar.gz</a>。</p>
</div>
<div id="运行rnacocktail" class="section level3">
<h3>5 运行RNACocktail</h3>
<p><code>run_rnacocktail.py -h</code> get help<br />
<code>run_rnacocktail.py align -h</code> get short-read alignment help.<br />
<code>run_rnacocktail.py reconstruct -h</code> get short-read transcriptome reconstruction help.<br />
<code>run_rnacocktail.py quantify -h</code> get short-read quantification help.<br />
<code>run_rnacocktail.py diff -h</code> get short-read differential expression help.<br />
<code>run_rnacocktail.py denovo -h</code> get short-read de novo assembly help.<br />
<code>run_rnacocktail.py long_correct -h</code> get long-read error correction help.<br />
<code>run_rnacocktail.py long_align -h</code> get long-read alignment help.<br />
<code>run_rnacocktail.py long_reconstruct -h</code> get long-read transcriptome reconstruction help.<br />
<code>run_rnacocktail.py long_fusion -h</code> get long-read fusion detection help.<br />
<code>run_rnacocktail.py variant -h</code> get variant calling help.<br />
<code>run_rnacocktail.py editing -h</code> get RNA editing detection help.<br />
<code>run_rnacocktail.py fusion -h</code> get RNA fusion detection help.<br />
<code>run_rnacocktail.py all -h</code> get running all RNACocktail pipeline steps help.</p>
<p>RNACocktail的all模式会根据输入数据，自动执行尽可能全面的分析，包括从比对到差异表达式分析的等步骤。</p>
</div>
<div id="rnacoktail测试" class="section level3">
<h3>6 RNACoktail测试</h3>
<p><strong>Small test</strong><br />
<code>cd test</code><br />
<code>./test_run.sh</code></p>
<p><strong>Extensive test of all modes on Docker image</strong><br />
<code>cd test</code><br />
<code>./docker_test.sh</code></p>
</div>
<div id="分析脚本" class="section level3">
<h3>7 分析脚本</h3>
<p>分析用到的脚本可以在<code>analaysis_scripts</code>文件夹中找到</p>
</div>
<div id="输出文件" class="section level3">
<h3>8 输出文件</h3>
<p>下表总结了各个RNACocktail模式下可能生成的输出文件。</p>
<table>
<colgroup>
<col width="24%" />
<col width="17%" />
<col width="21%" />
<col width="35%" />
</colgroup>
<thead>
<tr class="header">
<th>Task</th>
<th>Command</th>
<th>Default Tool</th>
<th>Output Files</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Short-read alignment</td>
<td>align</td>
<td>HISAT2</td>
<td><strong>alignments:</strong>alignments.sorted.bam <strong>junctions:</strong>splicesites.tab</td>
</tr>
<tr class="even">
<td>Short-read transcriptome reconstruction</td>
<td>reconstruct</td>
<td>StringTie</td>
<td><strong>trasncripts:</strong>transcripts.gtf <strong>expressions:</strong>gene_abund.tab</td>
</tr>
<tr class="odd">
<td>Short-read quantification</td>
<td>quantify</td>
<td>Salmon-SMEM</td>
<td><strong>expressions:</strong>quant.sf</td>
</tr>
<tr class="even">
<td>Short-read differential expression</td>
<td>diff</td>
<td>DESeq2</td>
<td><strong>differential expressions:</strong>deseq2_res.tab</td>
</tr>
<tr class="odd">
<td>Short-read de novo assembly</td>
<td>denovo</td>
<td>Oases</td>
<td><strong>trasncripts:</strong>transcripts.fa</td>
</tr>
<tr class="even">
<td>Long-read error correction</td>
<td>long_correct</td>
<td>LoRDEC</td>
<td><strong>corrected reads:</strong>long_corrected.fa</td>
</tr>
<tr class="odd">
<td>Long-read alignment</td>
<td>long_align</td>
<td>STARlong</td>
<td><strong>alignments:</strong>Aligned.out.psl</td>
</tr>
<tr class="even">
<td>Long-read transcriptome reconstruction</td>
<td>long_reconstruct</td>
<td>IDP</td>
<td><strong>trasncripts:</strong>isoform.gtf <strong>expressions:</strong>isoform.exp</td>
</tr>
<tr class="odd">
<td>Long-read fusion detection</td>
<td>long_fusion</td>
<td>IDP-fusion</td>
<td><strong>fusions:</strong>fusion_report.tsv</td>
</tr>
<tr class="even">
<td>Variant calling</td>
<td>variant</td>
<td>GATK</td>
<td><strong>variants:</strong>variants_filtered.vcf</td>
</tr>
<tr class="odd">
<td>RNA editing detection</td>
<td>editing</td>
<td>GIREMI</td>
<td><strong>edits:</strong>giremi_out.txt.res</td>
</tr>
<tr class="even">
<td>RNA Fusion detection</td>
<td>fusion</td>
<td>FusionCatcher</td>
<td><strong>fusions:</strong>final-list_candidate-fusion-genes.txt</td>
</tr>
<tr class="odd">
<td>Running all steps</td>
<td>all</td>
<td>whole pipeline</td>
<td>all outputs of the successful steps.</td>
</tr>
</tbody>
</table>
</div>
<div id="example" class="section level3">
<h3>9 Example</h3>
<p>接下来介绍用于以各种模式和数据类型（short-reads和long-reads）运行RNACocktail的一些Example 命令行。特别地，Example 17和18显示了如何使用<code>all</code>模式进行最全面的分析。注意RNACocktail需要预先构建参考基因组和参考转录组的索引。</p>
<p><strong>Example 1 (align short paired-end):</strong><br />
Run of RNACocktail for alignment of paired-end short-read sequences (HISAT2).</p>
<pre><code>run_rnacocktail.py align \
      --align_idx hisat2-idx \
      --outdir out \
      --workdir work \
      --ref_gtf genes.GRCh37.gtf \
      --1 seq_1.fq.gz \
      --2 seq_2.fq.gz \
      --hisat2 /path/to/hisat2 \
      --hisat2_sps /path/to/hisat2_extract_splice_sites.py \
      --samtools /path/to/samtools \
      --threads 10 \
      --sample A</code></pre>
<p><strong>Example 2 (align short single-end):</strong><br />
Run of RNACocktail for alignment of single-end short-read sequences (HISAT2).</p>
<pre><code>run_rnacocktail.py align \
      --align_idx hisat2-idx \
      --outdir out \
      --workdir work \
      --ref_gtf genes.GRCh37.gtf \
      --U seq.fq.gz \
      --hisat2 /path/to/hisat2 \
      --hisat2_sps /path/to/hisat2_extract_splice_sites.py \
      --samtools /path/to/samtools \
      --threads 10 \
      --sample A</code></pre>
<p><strong>Example 3 (reconstruct short-read):</strong><br />
Run of RNACocktail for short-read transcriptome reconstruction (StringTie).</p>
<pre><code>run_rnacocktail.py reconstruct \
      --alignment_bam work/hisat2/A/alignments.sorted.bam \
      --outdir out \
      --workdir work \
      --ref_gtf genes.GRCh37.gtf \
      --stringtie /path/to/stringtie \
      --threads 10 \
      --sample A</code></pre>
<p><strong>Example 4 (quantify short paired-end):(alignment-free)</strong><br />
Run of RNACocktail for (alignment-free) quantification of paired-end short-read sequences (Salmon-SMEM).</p>
<pre><code>salmon index \
    -t Homo_sapiens.GRCh38.cdna.1.fa \
    -i Homo_sapiens.GRCh38.cdna.1.quasi \
    --type quasi
    
for sample in A1 A2 B1 B2
do 
run_rnacocktail.py quantify 
      --quantifier_idx Homo_sapiens.GRCh38.cdna.1.quasi \
      --1 ../${sample}_1.fq.gz \
      --2 ../${sample}_2.fq.gz \
      --libtype IU \
      --salmon_k 19 \
      --outdir out \
      --workdir work \
      --salmon salmon \
      --threads 4 \
      --sample A \
      --unzip
done   
</code></pre>
<p><strong>Example 5 (quantify short single-end):(alignment-free)</strong><br />
Run of RNACocktail for (alignment-free) quantification of single-end short-read sequences (Salmon-SMEM).</p>
<pre><code>salmon index \
    -t Homo_sapiens.GRCh38.cdna.1.fa \
    -i Homo_sapiens.GRCh38.cdna.1.quasi \
    --type quasi


for sample in A1 A2 B1 B2
do  
run_rnacocktail.py quantify \
  --quantifier_idx Homo_sapiens.GRCh38.cdna.1.quasi \
  --U ../${sample}.fq.gz \
  --libtype IU \
  --salmon_k 19 \
  --outdir out  \
  --workdir work \
  --threads 4 \
  --sample ${sample} \
  --unzip 
done
 </code></pre>
<p><strong>Example 6 (diff alignment-free):</strong><br />
Run of RNACocktail for differential expression analysis of quantifications computed using Salmon-SMEM (DESeq2).</p>
<pre><code>run_rnacocktail.py diff \
    --quant_files \
      work/salmon_smem/A1/quant.sf,work/salmon_smem/A2/quant.sf \
      work/salmon_smem/B1/quant.sf,work/salmon_smem/B2/quant.sf \
    --sample A1,A2 B1,B2 \
    --ref_gtf Homo_sapiens.GRCh38.90.chr.1.gtf \
    --outdir out \
    --workdir work</code></pre>
<p><strong>Example 7 (diff alignment):</strong><br />
Run of RNACocktail for differential expression analysis of reads aligned using HISAT2 on reference transcriptome (DESeq2).</p>
<pre><code>run_rnacocktail.py diff \
    --alignments \
      work/hisat2/A1/alignments.sorted.bam,work/hisat2/A2/alignments.sorted.bam \
      work/hisat2/B1/alignments.sorted.bam,work/hisat2/B2/alignments.sorted.bam \
    --sample A1,A2 B1,B2 \
    --ref_gtf genes.GRCh37.gtf \
    --outdir out \
    --workdir work \
    --featureCounts /path/to/featureCounts</code></pre>
<p><strong>Example 8 (diff):</strong><br />
Run of RNACocktail for differential expression analysis of reads aligned using HISAT2 on StringTie computed transcriptome (DESeq2).</p>
<pre><code>run_rnacocktail.py diff \
    --alignments \
      work/hisat2/A1/alignments.sorted.bam,work/hisat2/A2/alignments.sorted.bam \
      work/hisat2/B1/alignments.sorted.bam,work/hisat2/B2/alignments.sorted.bam \
    --transcripts_gtfs work/stringtie/A1/transcripts.gtf,work/stringtie/A2/transcripts.gtf \
      work/stringtie/B1/transcripts.gtf,work/stringtie/B2/transcripts.gtf \
    --sample A1,A2 B1,B2 \
    --ref_gtf genes.GRCh37.gtf \
    --outdir out \
    --workdir work \
    --featureCounts /path/to/featureCounts</code></pre>
<p><strong>Example 9 (denovo):</strong><br />
Run of RNACocktail for de novo assembly (Oases).</p>
<pre><code>run_rnacocktail.py denovo \
    --1 seq_1.fq.gz \
    --2 seq_2.fq.gz \
    --outdir out \
    --workdir work \
    --oases /path/to/oases \
    --velveth /path/to/velveth \
    --velvetg /path/to/velvetg \
    --threads 4 \
    --sample A \
    --file_format fastq.gz</code></pre>
<p><strong>Example 10 (long_correct):</strong><br />
Run of RNACocktail for long-read error correction (LoRDEC).</p>
<pre><code>run_rnacocktail.py long_correct \
    --kmer 23 \
    --solid 3 \
    --short seq.fq.gz \
    --long seq_long.fa \
    --outdir out \
    --workdir work \
    --lordec /path/to/lordec-correct \
    --threads 4 \
    --sample A</code></pre>
<p><strong>Example 11 (long_align):</strong><br />
Run of RNACocktail for long-read alignment (STARlong).</p>
<pre><code>run_rnacocktail.py long_align \
    --long work/lordec/A/long_corrected.fa \
    --outdir out \
    --workdir work \
    --starlong /path/to/STARlong \
    --threads 4 \
    --sample A \
    --sam2psl /path/to/sam2psl.py \
    --samtools /path/to/samtools -\
    -genome_dir /path/to/STAR/genome_idx</code></pre>
<p><strong>Example 12 (long_reconstruct):</strong></p>
<p>Run of RNACocktail for long-read transcriptome reconstruction (IDP).</p>
<pre><code>run_rnacocktail.py long_reconstruct \
    --alignment work/hisat2/A/alignments.sorted.bam \
    --short_junction work/hisat2/A/splicesites.bed \
    --long_alignment work/starlong/A/Aligned.out.psl \
    --outdir out \
    --workdir work \
    --idp /path/to/runIDP.py \
    --threads 4 \
    --sample A \
    --read_length 100 \
    --ref_genome genome.GRCh37.fa \
    --ref_all_gpd hg19.all.refSeq_gencode_ensemble_EST_known.gpd \
    --ref_gpd genes.GRCh37.refFlat.txt \
    --samtools /path/to/samtools \
    --idp_cfg idp.cfg</code></pre>
<p><strong>Example 13 (long_fusion):</strong><br />
Run of RNACocktail for long-read fusion detection (IDP-fusion).</p>
<pre><code>run_rnacocktail.py long_fusion \
    --alignment work/hisat2/A/alignments.sorted.bam \
    --short_junction work/hisat2/A/splicesites.bed \
    --short_fasta seq.fa \
    --long_fasta work/lordec/A/long_corrected.fa \
    --outdir out \
    --workdir work \
    --threads 4 \
    --sample A \
    --ref_genome genome.GRCh37.fa \
    --ref_all_gpd hg19.all.refSeq_gencode_ensemble_EST_known.gpd \
    --ref_gpd genes.GRCh37.refFlat.txt \
    --read_length 100 \
    --genome_bowtie2_idx genome.bt2_idx \
    --transcriptome_bowtie2_idx genes.bt2_idx \
    --uniqueness_bedgraph uniqueness.bedGraph \
    --gmap_idx gmap_idx \
    --idpfusion /path/to/runIDP.py \
    --samtools /path/to/samtools \
    --idpfusion_cfg idpfusion.cfg</code></pre>
<p><strong>Example 14 (variant):</strong><br />
Run of RNACocktail for RNA-Seq variant calling (GATK) with enabled IndelRealignment.</p>
<pre><code>run_rnacocktail.py variant \
    --alignment work/hisat2/A/alignments.sorted.bam \
    --outdir out \
    --workdir work \
    --picard /path/to/picard.jar \
    --gatk /path/to/GenomeAnalysisTK.jar \
    --threads 10 \
    --sample A \
    --ref_genome genome.GRCh37.fa \
    --IndelRealignment \
    --knownsites dbsnp_138.b37.vcf</code></pre>
<p><strong>Example 15 (editing):</strong>
Run of RNACocktail for RNA editing detection (GIREMI)</p>
<pre><code>run_rnacocktail.py editing \
    --alignment work/gatk/A/bsqr.bam \
    --variant work/gatk/A/variants_filtered.vcf \
    --strand_pos test/GRCh37_strand_pos.bed \
    --genes_pos test/GRCh37_genes_pos.bed \
    --outdir out \
    --workdir work \
    --giremi_dir /path/to/giremi/directory/ \
    --gatk /path/to/GenomeAnalysisTK.jar \
    --samtools /path/to/samtools \
    --htslib_dir /path/to/htslib/directory/ \
    --threads 10 \
    --sample A \
    --ref_genome genome.GRCh37.fa \
    --knownsites dbsnp_138.b37.vcf</code></pre>
<p><strong>Example 16 (fusion):</strong>
Run of RNACocktail for RNA fusion detection (FusionCatcher)</p>
<pre><code>run_rnacocktail.py fusion \
    --data_dir /path/to/fusioncatcher/ensembl/data/directory/ \
    --input seq_1.fq.gz,seq_2.fq.gz \
    --outdir out \
    --workdir work \
    --fusioncatcher /path/to/fusioncatcher \
    --threads 4 \
    --sample A</code></pre>
<p><strong>Example 17 (all):</strong>
Run all pipeline steps (Short-read example)</p>
<pre><code>run_rnacocktail.py all \
    --outdir out \
    --workdir work \
    --threads 10 \
    --1 A1_1.fq.gz,A2_1.fq.gz B1_1.fq.gz,B2_1.fq.gz \
    --2 A1_2.fq.gz,A2_2.fq.gz B1_2.fq.gz,B2_2.fq.gz \
    --sample all_A1,all_A2 all_B1,all_B2 \
    --ref_gtf genes.GRCh37.gtf \
    --ref_genome genome.GRCh37.fa \
    --align_idx hisat2-idx \
    --quantifier_idx salmon_fmd_idx \
    --unzip \
    --file_format fastq.gz \
    --IndelRealignment \
    --CleanSam \
    --knownsites dbsnp_138.b37.vcf \
    --strand_pos test/GRCh37_strand_pos.bed \
    --genes_pos test/GRCh37_genes_pos.bed \
    --data_dir /path/to/fusioncatcher/ensembl/data/directory/ \
    --giremi_dir /path/to/giremi/directory/ \
    --gatk /path/to/GenomeAnalysisTK.jar \
    --htslib_dir /path/to/htslib/directory/ \
    --picard /path/to/picard.jar \
    --samtools /path/to/samtools \
    --hisat2 /path/to/hisat2 \
    --hisat2_sps /path/to/hisat2_extract_splice_sites.py \
    --stringtie /path/to/stringtie \
    --salmon /path/to/salmon \
    --featureCounts /path/to/featureCounts \
    --oases /path/to/oases \
    --velveth /path/to/velveth \
    --velvetg /path/to/velvetg \
    --lordec /path/to/lordec-correct \
    --sam2psl /path/to/sam2psl.py \
    --fusioncatcher /path/to/fusioncatcher</code></pre>
<p><strong>Example 18 (all):</strong>
Run all pipeline steps (long-read example)</p>
<pre><code>run_rnacocktail.py all \
    --outdir out \
    --workdir work \
    --threads 10 \
    --U seq_short.fa \
    --long seq_long.fa \
    --sample all_C \
    --ref_gtf genes.GRCh37.gtf \
    --ref_genome genome.GRCh37.fa \
    --align_idx hisat2-idx \
    --quantifier_idx salmon_fmd_idx \
    --unzip \
    --file_format fasta \
    --IndelRealignment \
    --CleanSam \
    --knownsites dbsnp_138.b37.vcf \
    --strand_pos test/GRCh37_strand_pos.bed \
    --genes_pos test/GRCh37_genes_pos.bed \
    --data_dir /path/to/fusioncatcher/ensembl/data/directory/ \
    --giremi_dir /path/to/giremi/directory/ \
    --gatk /path/to/GenomeAnalysisTK.jar \
    --htslib_dir /path/to/htslib/directory/ \
    --star_genome_dir /path/to/STAR/genome_idx/ \
    --genome_bowtie2_idx genome.bt2_idx \
    --transcriptome_bowtie2_idx genes.bt2_idx \
    --uniqueness_bedgraph uniqueness.bedGraph \
    --gmap_idx gmap_idx \
    --ref_all_gpd hg19.all.refSeq_gencode_ensemble_EST_known.gpd \
    --ref_gpd genes.GRCh37.refFlat.txt \
    --read_length 100 \
    --picard /path/to/picard.jar \
    --hisat2_opts \&quot;-f\&quot; \
    --idp /path/to/idp/runIDP.py \
    --idpfusion /path/to/idpfusion/runIDP.py \
    --samtools /path/to/samtools \
    --hisat2 /path/to/hisat2 \
    --hisat2_sps /path/to/hisat2_extract_splice_sites.py \
    --stringtie /path/to/stringtie \
    --salmon /path/to/salmon \
    --featureCounts /path/to/featureCounts \
    --oases /path/to/oases \
    --velveth /path/to/velveth \
    --velvetg /path/to/velvetg \
    --lordec /path/to/lordec-correct \
    --sam2psl /path/to/sam2psl.py \
    --fusioncatcher /path/to/fusioncatcher</code></pre>
<p><strong>准备基因组的index文件</strong><br />
<strong>HISAT2</strong><br />
<code>hisat2-build [options] reference.fa hisat2_index_basename</code><br />
<a href="http://ccb.jhu.edu/software/hisat2/manual.shtml">more</a></p>
<p><strong>Salmon-SMEM</strong><br />
<code>salmon index -t reference.fa -i salmon_index_basename --type fmd</code><br />
<a href="http://salmon.readthedocs.io/en/latest/salmon.html#using-salmon">more</a></p>
<p><strong>STAR</strong><br />
<code>STAR --runMode genomeGenerate --genomeDir STAR_index_basename --genomeFastaFiles reference.fa --runThreadN 4</code><br />
<a href="http://chagall.med.cornell.edu/RNASEQcourse/STARmanual.pdf">more</a></p>
<p><strong>GMAP</strong><br />
<code>gmap_build -d gmap_index_basename reference.fa</code><br />
<a href="http://research-pub.gene.com/gmap/">more</a></p>
<p><strong>bowtie2</strong><br />
<code>bowtie2-build reference.fa bowtie2_index_basename</code><br />
<a href="http://bowtie-bio.sourceforge.net/bowtie2/index.shtml">more</a></p>
<p><strong>测试运行(简单版)</strong></p>
<pre><code>mkdir example_small
cd example_small</code></pre>
<p><strong>Download reference genome (chromosome 21) FASTA file</strong></p>
<pre><code>wget ftp://ftp.ensembl.org/pub/release-75//fasta/homo_sapiens/dna/Homo_sapiens.GRCh37.75.dna.chromosome.21.fa.gz</code></pre>
<p><strong>Unzip reference genome (chromosome 21) FASTA file</strong></p>
<pre><code>gunzip Homo_sapiens.GRCh37.75.dna.chromosome.21.fa.gz</code></pre>
<p><strong>Download reference annotation GTF file</strong></p>
<pre><code>wget ftp://ftp.ensembl.org/pub/release-75//gtf/homo_sapiens/Homo_sapiens.GRCh37.75.gtf.gz</code></pre>
<p><strong>Unzip reference annotation GTF file</strong></p>
<pre><code>gunzip Homo_sapiens.GRCh37.75.gtf.gz</code></pre>
<p><strong>Restrict GTF to chromosome 21</strong></p>
<pre><code>less Homo_sapiens.GRCh37.75.gtf |awk &#39;{if ($1==21) print}&#39; &gt; Homo_sapiens.GRCh37.75.chromosome.21.gtf</code></pre>
<p><strong>Index genome with HISAT2</strong></p>
<pre><code># conda  install hisat2
hisat2-build Homo_sapiens.GRCh37.75.dna.chromosome.21.fa Homo_sapiens.GRCh37.75.dna.chromosome.21.HISAT2</code></pre>
<p><strong>Test alignment step using HISAT2</strong></p>
<pre><code>run_rnacocktail.py align \
    --align_idx Homo_sapiens.GRCh37.75.dna.chromosome.21.HISAT2 \
    --outdir out \
    --workdir work \
    --ref_gtf Homo_sapiens.GRCh37.75.chromosome.21.gtf \
    --1 ../A1_1.fq.gz  \
    --2 ../A1_2.fq.gz \
    --hisat2 hisat2 \
    --hisat2_sps hisat2_extract_splice_sites.py  \
    --samtools samtools 
    --sample A</code></pre>
<p><strong>Test reconstruction step using StringTie</strong></p>
<pre><code>run_rnacocktail.py reconstruct \
    --alignment_bam work/hisat2/A/alignments.sorted.bam \
    --outdir out \
    --workdir work \
    --ref_gtf Homo_sapiens.GRCh37.75.chromosome.21.gtf \
    --stringtie stringtie \
    --sample A</code></pre>
<p><strong>测试运行(docker版)</strong></p>
<pre><code>mkdir example
chmod -R 777 example/
cd example

echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Initialization&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Download reference genome (chromosome 21) FASTA file&quot;
wget ftp://ftp.ensembl.org/pub/release-90//fasta/homo_sapiens/dna/Homo_sapiens.GRCh38.dna.chromosome.21.fa.gz

echo &quot;Unzip reference genome (chromosome 21) FASTA file&quot;
gunzip Homo_sapiens.GRCh38.dna.chromosome.21.fa.gz

echo &quot;Download reference annotation GTF file&quot;
wget ftp://ftp.ensembl.org/pub/release-90//gtf/homo_sapiens/Homo_sapiens.GRCh38.90.gtf.gz

echo &quot;Unzip reference annotation GTF file&quot;
gunzip Homo_sapiens.GRCh38.90.gtf.gz

echo &quot;Restrict GTF to chromosome 21&quot;
less Homo_sapiens.GRCh38.90.gtf |awk &#39;{if ($1==21) print}&#39; &gt; Homo_sapiens.GRCh38.90.chromosome.21.gtf

echo &quot;Prepare reference transcriptome FASTA file&quot;
docker run -v=${PWD}/:/work_dir/ marghoob/rnacocktail gffread \
                                /work_dir/index/Homo_sapiens.GRCh38.90.chromosome.21.gtf \
                                -g /work_dir/index/Homo_sapiens.GRCh38.dna.chromosome.21.fa \
                                -w /work_dir/index/Homo_sapiens.GRCh38.cdna.21.fa

gunzip -c ../C_long.fa.gz &gt; C_long.fa
gunzip -c ../C_short.fa.gz &gt; C_short.fa
gunzip -c ../GRCh38_genes_pos.bed.gz &gt; GRCh38_genes_pos.bed
gunzip -c ../GRCh38_strand_pos.bed.gz &gt; GRCh38_strand_pos.bed
gunzip -c ../GRCh38.21.gpd.gz &gt; GRCh38.21.gpd


echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Test short-read alignment (HISAT2)&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Index genome (chromosome 21) with HISAT2&quot;
docker run -v=${PWD}/:/work_dir/ marghoob/rnacocktail hisat2-build \
                                /work_dir/index/Homo_sapiens.GRCh38.dna.chromosome.21.fa \
                                /work_dir/index/Homo_sapiens.GRCh38.dna.chromosome.21.HISAT2
                                
                                
for sample in A1 A2 B1 B2
do
docker run -v=${PWD}/:/work_dir/ marghoob/rnacocktail run_rnacocktail.py align \
                                --align_idx /work_dir/index/Homo_sapiens.GRCh38.dna.chromosome.21.HISAT2 \
                                --outdir /work_dir/01_align \
                                --workdir /work_dir/work \
                                --ref_gtf /work_dir/Ref/Homo_sapiens.GRCh38.90.chromosome.21.gtf \
                                --1 /work_dir/raw_data/${sample}_1.fq.gz  \
                                --2 /work_dir/raw_data/${sample}_2.fq.gz \
                                --sample ${sample}
done
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Test short-read transcriptome reconstruction (StringTie)&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
for sample in A1 A2 B1 B2
do
docker run -v=${PWD}/:/work_dir/ marghoob/rnacocktail run_rnacocktail.py reconstruct \
                                --alignment_bam /work_dir/01_align/hisat2/${sample}/alignments.sorted.bam \
                                --outdir /work_dir/02_reconstruct/  \
                                --workdir /work_dir/work \
                                --ref_gtf /work_dir/Ref/Homo_sapiens.GRCh38.90.chromosome.21.gtf \
                                --sample ${sample}
done

echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Test quantification (Salmon-SMEM)&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Index transcriptome with Salmon-SMEM&quot;
docker run -v=${PWD}/:/work_dir/  marghoob/rnacocktail salmon index \
                                -t /work_dir/Ref/Homo_sapiens.GRCh38.cdna.21.fa  \
                                -i /work_dir/index/Homo_sapiens.GRCh38.cdna.21.Salmon.fmd \
                                --type fmd
for sample in A1 A2 B1 B2
do
docker run -v=${PWD}/:/work_dir/ marghoob/rnacocktail run_rnacocktail.py quantify \
                                --quantifier_idx /work_dir/index/Homo_sapiens.GRCh38.cdna.21.Salmon.fmd \
                                --1 /work_dir/raw_data/${sample}_1.fq.gz \
                                --2 /work_dir/raw_data/${sample}_2.fq.gz \
                                --libtype IU \
                                --salmon_k 19 \
                                --outdir /work_dir/03_quantify/ \
                                --workdir /work_dir/work \
                                --threads 4 \
                                --sample ${sample} \
                                --unzip
done

echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Test differential expression analysis based on alignment&quot;
echo &quot;results(DESeq2)&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail run_rnacocktail.py diff \
                                --alignments /work_dir/example/work/hisat2/A1/alignments.sorted.bam,/work_dir/example/work/hisat2/A2/alignments.sorted.bam /work_dir/example/work/hisat2/B1/alignments.sorted.bam,/work_dir/example/work/hisat2/B2/alignments.sorted.bam \
                                --sample A1,A2 B1,B2 \
                                --ref_gtf /work_dir/example/Homo_sapiens.GRCh38.90.chromosome.21.gtf \
                                --outdir /work_dir/example/out/diff-alignment/ \
                                --workdir /work_dir/example/work/diff-alignment/

echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Test differential expression analysis based on alignment-free&quot;
echo &quot;quantifications (DESeq2)&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail run_rnacocktail.py diff \
                                --quant_files /work_dir/example/work/salmon_smem/A1/quant.sf,/work_dir/example/work/salmon_smem/A2/quant.sf /work_dir/example/work/salmon_smem/B1/quant.sf,/work_dir/example/work/salmon_smem/B2/quant.sf \
                                --sample A1,A2 B1,B2 \
                                --ref_gtf /work_dir/example/Homo_sapiens.GRCh38.90.chromosome.21.gtf \
                                --outdir /work_dir/example/out/diff-quant \
                                --workdir /work_dir/example/work/diff-quant

echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Test de novo assembly (Oases)&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail run_rnacocktail.py denovo \
                                --1 /work_dir/A1_1.fq.gz \
                                --2 /work_dir/A1_2.fq.gz \
                                --outdir /work_dir/example/out \
                                --workdir /work_dir/example/work \
                                --threads 4 \
                                --sample A1 \
                                --file_format fastq.gz


echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Test short-read fusion detection (FusionCatcher)&quot;
echo &quot;Note: downloading FusionCatcher necessary data may take 1-2 hours&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
mkdir fusioncatcher_data
cd fusioncatcher_data
wget https://sourceforge.net/projects/fusioncatcher/files/data/human_v90.tar.gz.aa &amp;
wget https://sourceforge.net/projects/fusioncatcher/files/data/human_v90.tar.gz.ab &amp;
wget https://sourceforge.net/projects/fusioncatcher/files/data/human_v90.tar.gz.ac
wget https://sourceforge.net/projects/fusioncatcher/files/data/human_v90.tar.gz.ad
cat human_v90.tar.gz.* | tar xz
rm -rf human_v90.tar.gz.a*

wget http://sourceforge.net/projects/fusioncatcher/files/test/reads_1.fq.gz &amp;
wget http://sourceforge.net/projects/fusioncatcher/files/test/reads_2.fq.gz
cd ..

docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail run_rnacocktail.py fusion \
                                --data_dir /work_dir/example/fusioncatcher_data/human_v90/ \
                                --input /work_dir/example/fusioncatcher_data/reads_1.fq.gz,/work_dir/example/fusioncatcher_data/reads_2.fq.gz \
                                --outdir /work_dir/example/out \
                                --workdir /work_dir/example/work \
                                --threads 4 \
                                --sample D

echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Test long-read error correction (LoRDEC)&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail run_rnacocktail.py long_correct \
                                --kmer 23 \
                                --solid 3 \
                                --short /work_dir/example/C_short.fa \
                                --long /work_dir/example/C_long.fa \
                                --outdir /work_dir/example/out \
                                --workdir /work_dir/example/work \
                                --sample C

echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Test long-read alignment (STARlong)&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Index genome with STAR&quot;
mkdir STAR_genome_index_21/
chmod -R 777 STAR_genome_index_21/
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail STAR \
                                --runMode genomeGenerate \
                                --genomeDir /work_dir/example/STAR_genome_index_21/ \
                                --genomeFastaFiles /work_dir/example/Homo_sapiens.GRCh38.dna.chromosome.21.fa \
                                --runThreadN 4
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail run_rnacocktail.py long_align \
                                --long /work_dir/example/work/lordec/C/long_corrected.fa \
                                --threads 4 \
                                --outdir /work_dir/example/out \
                                --workdir /work_dir/example/work \
                                --sample C \
                                --genome_dir /work_dir/example/STAR_genome_index_21/

echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Test long-read transcriptome reconstruction (IDP)&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Index genome with STAR&quot;
echo &quot;Download refFlat.txt annotation file&quot;
wget http://hgdownload.cse.ucsc.edu/goldenpath/hg38/database/refFlat.txt.gz
gunzip refFlat.txt.gz
echo &quot;Restrict refFlat.txt annotation file to chromosome 21&quot;
less refFlat.txt |grep chr21 |sed &#39;s/chr21/21/g&#39; &gt; refFlat.21.txt
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail run_rnacocktail.py align \
                                --align_idx /work_dir/example/Homo_sapiens.GRCh38.dna.chromosome.21.HISAT2 \
                                --outdir /work_dir/example/out \
                                --workdir /work_dir/example/work \
                                --ref_gtf /work_dir/example/Homo_sapiens.GRCh38.90.chromosome.21.gtf \
                                --1 /work_dir/C_short_1.fq.gz  \
                                --2 /work_dir/C_short_2.fq.gz \
                                --sample C
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail run_rnacocktail.py long_reconstruct \
                                --alignment /work_dir/example/work/hisat2/C/alignments.sorted.bam \
                                --short_junction /work_dir/example/work/hisat2/C/splicesites.bed \
                                --long_alignment /work_dir/example/work/starlong/C/Aligned.out.psl \
                                --outdir /work_dir/example/out \
                                --workdir /work_dir/example/work \
                                --threads 4 \
                                --sample C \
                                --ref_genome /work_dir/example/Homo_sapiens.GRCh38.dna.chromosome.21.fa \
                                --ref_all_gpd /work_dir/example/GRCh38.21.gpd \
                                --ref_gpd /work_dir/example/refFlat.21.txt \
                                --read_length 101 \
                                --idp /opt/IDP/src/main/python/runIDP.py


echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Test long-read fusion detection (IDP-fusion)&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
wget https://www.healthcare.uiowa.edu/labs/au/IDP-fusion/files/MCF7_chr17q23-25chr20q13_Example.zip
unzip MCF7_chr17q23-25chr20q13_Example.zip
rm MCF7_chr17q23-25chr20q13_Example.zip
chmod 777 -R MCF7_chr17q23-25chr20q13_Example
echo &quot;Download reference annotation GTF file for GRCh37&quot;
wget ftp://ftp.ensembl.org/pub/release-75//gtf/homo_sapiens/Homo_sapiens.GRCh37.75.gtf.gz
echo &quot;Unzip reference annotation GTF file&quot;
gunzip Homo_sapiens.GRCh37.75.gtf.gz
echo &quot;Restrict GTF to chromosome 17 and 20&quot;
less Homo_sapiens.GRCh37.75.gtf |awk &#39;{if ($1==20 || $1==17) print}&#39;|sed &#39;s/^/chr/&#39; &gt; Homo_sapiens.GRCh37.75.chromosome.17_20.gtf
echo &quot;Index genome (chromosome 17 and 20) with HISAT2&quot;
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail hisat2-build \
                                /work_dir/example/MCF7_chr17q23-25chr20q13_Example/Data/genome.chr17chr20.fasta \
                                /work_dir/example/MCF7_chr17q23-25chr20q13_Example/Data/genome.chr17chr20.HISAT2
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail run_rnacocktail.py align \
                                --align_idx /work_dir/example/MCF7_chr17q23-25chr20q13_Example/Data/genome.chr17chr20.HISAT2 \
                                --outdir /work_dir/example/out \
                                --workdir /work_dir/example/work \
                                --ref_gtf /work_dir/example/Homo_sapiens.GRCh37.75.chromosome.17_20.gtf \
                                --U /work_dir/example/MCF7_chr17q23-25chr20q13_Example/Data/short_reads.chr17q23-25chr20q13.tenth.fasta \
                                --sample F \
                                --hisat2_opts \&quot;-f\&quot;
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail run_rnacocktail.py long_fusion \
                                --alignment /work_dir/example/work/hisat2/F/alignments.sorted.bam \
                                --short_junction /work_dir/example/work/hisat2/F/splicesites.bed \
                                --long_alignment /work_dir/example/MCF7_chr17q23-25chr20q13_Example/Data/MCF7_ready_for_fusion_20140928.chr17q23-25chr20q13.sorted.psl \
                                --short_fasta /work_dir/example/MCF7_chr17q23-25chr20q13_Example/Data/short_reads.chr17q23-25chr20q13.tenth.fasta \
                                --long_fasta /work_dir/example/MCF7_chr17q23-25chr20q13_Example/Data/long_reads.chr17q23-25chr20q13.fasta \
                                --outdir /work_dir/example/out \
                                --workdir /work_dir/example/work \
                                --threads 14 \
                                --sample F \
                                --ref_genome /work_dir/example/MCF7_chr17q23-25chr20q13_Example/Data/genome.chr17chr20.fasta \
                                --ref_all_gpd /work_dir/example/MCF7_chr17q23-25chr20q13_Example/Data/hg19.chr17chr20.gene_est.refFlat.txt \
                                --ref_gpd /work_dir/example/MCF7_chr17q23-25chr20q13_Example/Data/refFlat_20140611.chr17chr20.gpd.txt \
                                --read_length 89 \
                                --genome_bowtie2_idx /work_dir/example/MCF7_chr17q23-25chr20q13_Example/Data/bowtie2/bowtie2_index.chr17chr20 \
                                --transcriptome_bowtie2_idx /work_dir/example/MCF7_chr17q23-25chr20q13_Example/Data/bowtie2/txn.chr17chr20 \
                                --uniqueness_bedgraph /work_dir/example/MCF7_chr17q23-25chr20q13_Example/Data/wgEncodeDukeMapabilityUniqueness35bp.chr17chr20.bedGraph \
                                --gmap_idx /work_dir/example/MCF7_chr17q23-25chr20q13_Example/Data/gmap_index.chr17chr20/ \
                                --idpfusion /opt/IDP-fusion_1.1.1/bin/runIDP.py


echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Test variant calling (GATK)&quot;
echo &quot;Note: the test on variant calling and RNA editing detection may take several hours&quot;
echo &quot;Note: GATK .jar file (GenomeAnalysisTK.jar) should be available in the test folder.&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Download reference genome FASTA file&quot;
wget ftp://ftp.1000genomes.ebi.ac.uk/vol1/ftp/technical/reference/GRCh38_reference_genome/GRCh38_full_analysis_set_plus_decoy_hla.fa
echo &quot;Download dbsnp files&quot;
wget ftp://ftp.ncbi.nih.gov/snp/organisms/human_9606/VCF/All_20170710.vcf.gz
gunzip All_20170710.vcf.gz
 awk &#39;{if($0 !~ /^#/) print &quot;chr&quot;$0; else print $0}&#39; All_20170710.vcf |sed  &quot;s/chrMT/chrM/g&quot; &gt; All_20170710_chr.vcf
 mv All_20170710_chr.vcf All_20170710.vcf
echo &quot;Index reference genome FASTA file&quot;
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail samtools faidx /work_dir/example/GRCh38_full_analysis_set_plus_decoy_hla.fa
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail java -jar /usr/local/bin/picard.jar CreateSequenceDictionary \
                                R= /work_dir/example/GRCh38_full_analysis_set_plus_decoy_hla.fa \
                                O= /work_dir/example/GRCh38_full_analysis_set_plus_decoy_hla.dict
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail hisat2-build \
                                /work_dir/example/GRCh38_full_analysis_set_plus_decoy_hla.fa \
                                /work_dir/example/GRCh38_full_analysis_set_plus_decoy_hla.HISAT2
echo &quot;Download NA12878 FASTQ files&quot;

wget ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR896/SRR896663/SRR896663_1.fastq.gz
wget ftp://ftp.sra.ebi.ac.uk/vol1/fastq/SRR896/SRR896663/SRR896663_2.fastq.gz

docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail run_rnacocktail.py align \
                                --align_idx /work_dir/example/GRCh38_full_analysis_set_plus_decoy_hla.HISAT2 \
                                --outdir /work_dir/example/out \
                                --workdir /work_dir/example/work \
                                --ref_gtf /work_dir/example/Homo_sapiens.GRCh38.90.gtf \
                                --1 /work_dir/example/SRR896663_1.fastq.gz  \
                                --2 /work_dir/example/SRR896663_2.fastq.gz \
                                --sample E \
                                --threads 10
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail run_rnacocktail.py variant \
                                --alignment /work_dir/example/work/hisat2/E/alignments.sorted.bam \
                                --outdir /work_dir/example/out \
                                --workdir /work_dir/example/work \
                                --picard /usr/local/bin/picard.jar \
                                --gatk /work_dir/GenomeAnalysisTK.jar \
                                --threads 10 \
                                --sample E \
                                --ref_genome /work_dir/example/GRCh38_full_analysis_set_plus_decoy_hla.fa \
                                --IndelRealignment \
                                --CleanSam \
                                --knownsites /work_dir/example/All_20170710.vcf \
                                --picard /usr/local/bin/picard.jar

echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Test RNA editing detection (GIREMI)&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail run_rnacocktail.py editing \
                                --alignment /work_dir/example/work/gatk/E/bsqr.bam \
                                --variant /work_dir/example/work/gatk/E/variants_filtered.vcf \
                                --strand_pos /work_dir/example/GRCh38_strand_pos.bed \
                                --genes_pos /work_dir/example/GRCh38_genes_pos.bed \
                                --outdir /work_dir/example/out \
                                --workdir /work_dir/example/work \
                                --giremi_dir /usr/local/bin/ \
                                --gatk /work_dir/GenomeAnalysisTK.jar \
                                --htslib_dir /opt/htslib-1.3/ \
                                --threads 1 \
                                --sample E \
                                --ref_genome /work_dir/example/GRCh38_full_analysis_set_plus_decoy_hla.fa \
                                --knownsites /work_dir/example/All_20170710.vcf

echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Test run all pipeline (Short-read example)&quot;
echo &quot;This example should successfully run for short-read alignment,&quot;
echo &quot;reconstruction, quantification, differential expression,&quot;
echo &quot;denovo assembly, variant calling, and fusion detection.&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
cat &lt;(less All_20170710.vcf |head -10000|grep &quot;#&quot;) &lt;(less All_20170710.vcf |awk &#39;{if ($1==&quot;chr21&quot;) print}&#39;) |sed &quot;s/chr//g&quot; &gt; variants_21.vcf
cat GRCh38_genes_pos.bed |sed &quot;s/chrM/MT/g&quot;|sed &quot;s/chr//g&quot; &gt; GRCh38_genes_pos_.bed
cat GRCh38_strand_pos.bed |sed &quot;s/chrM/MT/g&quot;|sed &quot;s/chr//g&quot; &gt; GRCh38_strand_pos_.bed
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail samtools faidx /work_dir/example/Homo_sapiens.GRCh38.dna.chromosome.21.fa
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail java -jar /usr/local/bin/picard.jar CreateSequenceDictionary \
                                R= /work_dir/example/Homo_sapiens.GRCh38.dna.chromosome.21.fa \
                                O= /work_dir/example/Homo_sapiens.GRCh38.dna.chromosome.21.dict
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail run_rnacocktail.py all \
                                --outdir /work_dir/example/out \
                                --workdir /work_dir/example/work \
                                --threads 10 \
                                --1 /work_dir/A1_1.fq.gz,/work_dir/A2_1.fq.gz /work_dir/B1_1.fq.gz,/work_dir/B2_1.fq.gz \
                                --2 /work_dir/A1_2.fq.gz,/work_dir/A2_2.fq.gz /work_dir/B1_2.fq.gz,/work_dir/B2_2.fq.gz \
                                --sample all_A1,all_A2 all_B1,all_B2  \
                                --ref_gtf /work_dir/example/Homo_sapiens.GRCh38.90.chromosome.21.gtf  \
                                --ref_genome /work_dir/example/Homo_sapiens.GRCh38.dna.chromosome.21.fa \
                                --align_idx /work_dir/example/Homo_sapiens.GRCh38.dna.chromosome.21.HISAT2  \
                                --quantifier_idx /work_dir/example/Homo_sapiens.GRCh38.cdna.21.Salmon.fmd \
                                --unzip \
                                --file_format fastq.gz \
                                --IndelRealignment \
                                --CleanSam \
                                --knownsites /work_dir/example/variants_21.vcf \
                                --strand_pos /work_dir/example/GRCh38_strand_pos_.bed \
                                --genes_pos /work_dir/example/GRCh38_genes_pos_.bed \
                                --data_dir /work_dir/example/fusioncatcher_data/human_v90/ \
                                --giremi_dir /usr/local/bin/ \
                                --gatk /work_dir/GenomeAnalysisTK.jar \
                                --htslib_dir /opt/htslib-1.3/ \
                                --picard /usr/local/bin/picard.jar

echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;Test run all pipeline (Long-read example)&quot;
echo &quot;Thid example should successfully run for short-read alignment,&quot;
echo &quot;reconstruction, denovo assembly, quantification, &quot;
echo &quot;variant calling and long-read error correction,&quot;
echo &quot;alignment, and reconstruction&quot;
echo &quot;--------------------------------------------------------&quot;
echo &quot;--------------------------------------------------------&quot;
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail gmap_build \
                                -d /work_dir/example/gmap_chromosome.21 \
                                /work_dir/example/Homo_sapiens.GRCh38.dna.chromosome.21.fa
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail bowtie2-build \
                                /work_dir/example/Homo_sapiens.GRCh38.dna.chromosome.21.fa \
                                /work_dir/example/Homo_sapiens.GRCh38.dna.chromosome.21
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail bowtie2-build \
                                /work_dir/example/Homo_sapiens.GRCh38.cdna.21.fa \
                                /work_dir/example/Homo_sapiens.GRCh38.cdna.21
docker run -v=${PWD}/../:/work_dir/ marghoob/rnacocktail run_rnacocktail.py all \
                                --outdir /work_dir/example/out \
                                --workdir /work_dir/example/work \
                                --threads 10 \
                                --data_dir /work_dir/example/fusioncatcher_data/human_v90/ \
                                --U /work_dir/example/C_short.fa \
                                --long /work_dir/example/C_long.fa \
                                --sample all_C \
                                --ref_genome /work_dir/example/Homo_sapiens.GRCh38.dna.chromosome.21.fa \
                                --star_genome_dir /work_dir/example/STAR_genome_index_21/ \
                                --align_idx /work_dir/example/Homo_sapiens.GRCh38.dna.chromosome.21.HISAT2 \
                                --quantifier_idx /work_dir/example/Homo_sapiens.GRCh38.cdna.21.Salmon.fmd \
                                --gmap_idx /work_dir/example/gmap_chromosome.21 \
                                --genome_bowtie2_idx /work_dir/example/Homo_sapiens.GRCh38.dna.chromosome.21 \
                                --transcriptome_bowtie2_idx /work_dir/example/Homo_sapiens.GRCh38.cdna.21 \
                                --ref_all_gpd /work_dir/example/GRCh38.21.gpd \
                                --ref_gpd /work_dir/example/refFlat.21.txt \
                                --file_format fasta \
                                --IndelRealignment \
                                --CleanSam \
                                --knownsites /work_dir/example/variants_21.vcf \
                                --strand_pos /work_dir/example/GRCh38_strand_pos_.bed \
                                --genes_pos /work_dir/example/GRCh38_genes_pos_.bed \
                                --read_length 101 \
                                --hisat2_opts \&quot;-f\&quot; \
                                --giremi_dir /usr/local/bin/ \
                                --gatk /work_dir/GenomeAnalysisTK.jar \
                                --htslib_dir /opt/htslib-1.3/ \
                                --picard /usr/local/bin/picard.jar \
                                --idp /opt/IDP/src/main/python/runIDP.py \
                                --idpfusion /opt/IDP-fusion_1.1.1/bin/runIDP.py
</code></pre>
</div>
